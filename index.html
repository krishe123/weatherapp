<!DOCTYPE html>
<html lang="en">

<head>
    {% load static %} <!-- Don't forget to load the static tag library -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">

</head>

<body>
    <div class="card">
        <div class="search"> <!-- Corrected the class name -->
            <input type="text" placeholder="enter your city name" spellcheck="false">
            <button><img src="{% static 'img/search.png' %}" alt=""></button>
        </div>

        <div class="error">
            <p>Invalid city name</p>
        </div>

        <div class="weather">
            <img src="{% static 'img/surya.png' %}" alt="" class="weather-icon">
            <h1 class="temp">
                22°C
            </h1>
            <h2 class="city">

                baroda
            </h2>
            <div class="details">
                <div class="col">
                    <img src="{% static 'img/humidity.png' %}" alt="">
                    <div>
                        <p class="humidity">50%</p>
                        <p>
                            humidity
                        </p>
                    </div>
                </div>
                <div class="col">
                    <img src="{% static 'img/wind_speed.png' %}" alt="">
                    <div>
                        <p class="wind_speed">15 km/h</p>
                        <p>

                            Wind speed
                        </p>
                    </div>
                </div>
            </div>

        </div>
    </div>


    <script>
        // API key for accessing the OpenWeatherMap API
        const apikey = "a369027f333c8a147e244a3457daaa5a"
        
        // Base URL for fetching weather data with metric units
        const apiurl = "https://api.openweathermap.org/data/2.5/weather?&units=metric&q="

        // Selecting the input box where the user enters the city name
        const searchbox = document.querySelector(".search input")
        
        // Selecting the search button
        const searchbtn = document.querySelector(".search button")
        
        // Selecting the weather icon that will be dynamically changed based on the weather data
        const weathericon = document.querySelector(".weather-icon")

        // Function to check the weather for the city entered by the user
        async function checkweather(city) {
            // Making a request to the OpenWeatherMap API using the city name and API key
            const responce = await fetch(apiurl + city + `&appid=${apikey}`)

            // If the city name is invalid, the API returns a 404 status
            if (responce.status == 404) {
                // Show the error message
                document.querySelector(".error").style.display = "block"; 
                // Hide the weather information
                document.querySelector(".weather").style.display = "none";
            } else {
                // If the city name is valid, parse the JSON response
                var data = await responce.json()

                // Update the city name in the HTML
                document.querySelector(".city").innerHTML = data.name
                
                // Update the temperature in the HTML, rounded to the nearest integer
                document.querySelector(".temp").innerHTML = Math.round(data.main.temp) + " °C "
                
                // Update the humidity value in the HTML
                document.querySelector(".humidity").innerHTML = data.main.humidity + "%"
                
                // Update the wind speed value in the HTML
                document.querySelector(".wind_speed").innerHTML = data.wind.speed + " km/h"

                // Based on the weather condition, change the weather icon
                if (data.weather[0].main == "Clouds") {
                    weathericon.src = "{% static 'img/surya.png' %}" // Clouds icon
                } else if (data.weather[0].main == "Rain") {
                    weathericon.src = "{% static 'img/rain1.png' %}" // Rain icon
                } else if (data.weather[0].main == "Clear") {
                    weathericon.src = "{% static 'img/yellow.png' %}" // Clear weather (sun) icon
                } else if (data.weather[0].main == "Drizzle") {
                    weathericon.src = "{% static 'img/drizzle.png' %}" // Drizzle icon
                }

                // Show the weather information
                document.querySelector(".weather").style.display = "block"
                
                // Hide the error message
                document.querySelector(".error").style.display = "none"
            }
        }

        // Event listener for the search button click event
        searchbtn.addEventListener("click", () => {
            // When the button is clicked, call the checkweather function with the city name entered by the user
            checkweather(searchbox.value)
        })
    </script>
</body>

</html>